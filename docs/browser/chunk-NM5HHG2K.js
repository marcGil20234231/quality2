import{a as z,b as $,d as K,f as J,t as X}from"./chunk-WRGOV7ZX.js";import{b as Y,g as D,k as U}from"./chunk-4BZPK5W5.js";import{Aa as y,B as H,Fa as Q,Ja as _,Jb as W,K as P,Kb as F,N as V,Ob as L,Qa as m,Rb as N,S as R,Ta as s,Ua as a,Va as g,Ya as f,Z as p,Za as u,_ as d,_a as l,db as h,ea as j,f as k,fb as T,g as E,gb as v,hb as S,ib as b,j as C,k as I,n as w,na as A,v as O,wa as c,x as B}from"./chunk-4NTA57OQ.js";import{a as M}from"./chunk-2NFLSA4Y.js";var x=class n{constructor(e){this.http=e}apiUrl="http://localhost:3001";searchTerm$=new E("");handleError(e){return console.error("Search service error:",e),I(()=>new Error("Something went wrong with the search. Please try again."))}setSearchTerm(e){this.searchTerm$.next(e)}getSearchTerm(){return this.searchTerm$.asObservable()}searchAll(e){return e.trim()?this.http.get(`${this.apiUrl}/resources?q=${encodeURIComponent(e)}`).pipe(w(t=>({searchTerm:e,courses:[],teachers:[],resources:t})),P(t=>console.log("Search results:",t)),O(this.handleError)):C({searchTerm:"",courses:[],teachers:[],resources:[]})}getSuggestions(e){return e.trim()?this.http.get(`${this.apiUrl}/resources?q=${encodeURIComponent(e)}`).pipe(w(t=>{try{let r=new Set;return t.forEach(i=>{i.title.split(" ").forEach(o=>{o.toLowerCase().includes(e.toLowerCase())&&o.length>2&&r.add(o)}),i.tags&&i.tags.forEach(o=>{o.toLowerCase().includes(e.toLowerCase())&&r.add(o)})}),Array.from(r).slice(0,5)}catch(r){return console.error("Error processing suggestions:",r),[]}}),O(this.handleError)):C([])}static \u0275fac=function(t){return new(t||n)(R(Y))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function te(n,e){if(n&1){let t=f();s(0,"button",9),u("click",function(){p(t);let i=l();return d(i.clearSearch())}),g(1,"i",10),a()}}function re(n,e){if(n&1){let t=f();s(0,"div",19),u("click",function(){let i=p(t).$implicit,o=l(3);return d(o.selectHistoryItem(i))}),g(1,"i",20),h(2),s(3,"button",16),u("click",function(i){let o=p(t).$implicit,Z=l(3);return d(Z.removeFromHistory(o,i))}),g(4,"i",21),a()()}if(n&2){let t=e.$implicit;c(2),T(" ",t," ")}}function ie(n,e){if(n&1){let t=f();s(0,"div",13)(1,"div",14),g(2,"i",15),h(3," Recent Searches "),s(4,"button",16),u("click",function(){p(t);let i=l(2);return d(i.clearHistory())}),h(5,"Clear"),a()(),s(6,"div",17),_(7,re,5,1,"div",18),a()()}if(n&2){let t=l(2);c(7),m("ngForOf",t.searchHistory)}}function ne(n,e){if(n&1){let t=f();s(0,"div",19),u("click",function(){let i=p(t).$implicit,o=l(3);return d(o.selectSuggestion(i))}),g(1,"i",5),h(2),a()}if(n&2){let t=e.$implicit;c(2),T(" ",t," ")}}function oe(n,e){if(n&1&&(s(0,"div",13)(1,"div",14),g(2,"i",22),h(3," Suggestions "),a(),s(4,"div",17),_(5,ne,3,1,"div",18),a()()),n&2){let t=l(2);c(5),m("ngForOf",t.suggestions)}}function se(n,e){if(n&1&&(s(0,"div",11),_(1,ie,8,1,"div",12)(2,oe,6,1,"div",12),a()),n&2){let t=l();c(),m("ngIf",t.searchHistory.length>0),c(),m("ngIf",t.suggestions.length>0)}}function ae(n,e){if(n&1){let t=f();s(0,"div",23)(1,"div",24)(2,"h6"),h(3,"Advanced Search"),a(),s(4,"button",16),u("click",function(){p(t);let i=l();return d(i.toggleAdvancedOptions())}),g(5,"i",10),a()(),s(6,"div",25)(7,"div",26)(8,"input",27),b("ngModelChange",function(i){p(t);let o=l();return S(o.searchOptions.title,i)||(o.searchOptions.title=i),d(i)}),a(),s(9,"label",28),h(10,"Search in titles"),a()(),s(11,"div",26)(12,"input",29),b("ngModelChange",function(i){p(t);let o=l();return S(o.searchOptions.description,i)||(o.searchOptions.description=i),d(i)}),a(),s(13,"label",30),h(14,"Search in descriptions"),a()(),s(15,"div",26)(16,"input",31),b("ngModelChange",function(i){p(t);let o=l();return S(o.searchOptions.tags,i)||(o.searchOptions.tags=i),d(i)}),a(),s(17,"label",32),h(18,"Search in tags"),a()()()()}if(n&2){let t=l();c(8),v("ngModel",t.searchOptions.title),c(4),v("ngModel",t.searchOptions.description),c(4),v("ngModel",t.searchOptions.tags)}}function ce(n,e){n&1&&(s(0,"div",33),g(1,"i",34),h(2," Searching... "),a())}var G=class n{constructor(e,t,r){this.searchService=e;this.router=t;this.isBrowser=N(r),this.isBrowser&&this.loadSearchHistory()}placeholder="Search...";debounceTime=300;search=new j;searchQuery="";isSearching=!1;showSuggestions=!1;showAdvancedOptions=!1;suggestions=[];searchHistory=[];searchOptions={title:!0,description:!0,tags:!0};searchSubject=new k;HISTORY_KEY="search_history";MAX_HISTORY_ITEMS=5;isBrowser;ngOnInit(){this.searchSubject.pipe(B(this.debounceTime),H()).subscribe(e=>{e.trim()?(this.updateSuggestions(e),this.onSearch()):(this.search.emit({searchTerm:"",courses:[],teachers:[],resources:[]}),this.suggestions=[])})}onSearchInput(){this.searchSubject.next(this.searchQuery)}onSearch(){let e=this.searchQuery.trim();if(!e){this.search.emit({searchTerm:"",courses:[],teachers:[],resources:[]});return}this.isSearching=!0,this.addToHistory(e),this.searchService.searchAll(e).subscribe({next:t=>{this.search.emit(t),this.isSearching=!1},error:t=>{console.error("Search error:",t),this.isSearching=!1}})}clearSearch(){this.searchQuery="",this.search.emit({searchTerm:"",courses:[],teachers:[],resources:[]}),this.suggestions=[]}onBlur(){setTimeout(()=>{this.showSuggestions=!1},200)}toggleAdvancedOptions(){this.showAdvancedOptions=!this.showAdvancedOptions}updateSuggestions(e){this.searchService.getSuggestions(e).subscribe(t=>{this.suggestions=t})}loadSearchHistory(){if(this.isBrowser)try{let e=localStorage.getItem(this.HISTORY_KEY);this.searchHistory=e?JSON.parse(e):[]}catch(e){console.error("Error loading search history:",e),this.searchHistory=[]}}saveSearchHistory(){if(this.isBrowser)try{localStorage.setItem(this.HISTORY_KEY,JSON.stringify(this.searchHistory))}catch(e){console.error("Error saving search history:",e)}}addToHistory(e){this.searchHistory=this.searchHistory.filter(t=>t!==e),this.searchHistory.unshift(e),this.searchHistory=this.searchHistory.slice(0,this.MAX_HISTORY_ITEMS),this.saveSearchHistory()}clearHistory(){this.searchHistory=[],this.saveSearchHistory()}removeFromHistory(e,t){t.stopPropagation(),this.searchHistory=this.searchHistory.filter(r=>r!==e),this.saveSearchHistory()}selectHistoryItem(e){this.searchQuery=e,this.onSearch()}selectSuggestion(e){this.searchQuery=e,this.onSearch()}performSearch(){this.searchQuery.length>=3&&(this.router.navigate(["/search"],{queryParams:M({term:this.searchQuery},this.searchOptions)}),this.showSuggestions=!1)}static \u0275fac=function(t){return new(t||n)(y(x),y(D),y(A))};static \u0275cmp=Q({type:n,selectors:[["app-search-bar"]],inputs:{placeholder:"placeholder",debounceTime:"debounceTime"},outputs:{search:"search"},decls:9,vars:6,consts:[[1,"search-bar"],[1,"input-group"],["type","text",1,"form-control",3,"ngModelChange","input","keyup.enter","focus","blur","placeholder","ngModel"],["class","btn btn-outline-secondary","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"],[1,"bi","bi-search"],["class","search-dropdown",4,"ngIf"],["class","advanced-search",4,"ngIf"],["class","search-loading",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-lg"],[1,"search-dropdown"],["class","search-section",4,"ngIf"],[1,"search-section"],[1,"search-section-header"],[1,"bi","bi-clock-history"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"search-items"],["class","search-item",3,"click",4,"ngFor","ngForOf"],[1,"search-item",3,"click"],[1,"bi","bi-clock"],[1,"bi","bi-x"],[1,"bi","bi-lightbulb"],[1,"advanced-search"],[1,"advanced-search-header"],[1,"advanced-search-body"],[1,"form-check"],["type","checkbox","id","searchTitle",1,"form-check-input",3,"ngModelChange","ngModel"],["for","searchTitle",1,"form-check-label"],["type","checkbox","id","searchDescription",1,"form-check-input",3,"ngModelChange","ngModel"],["for","searchDescription",1,"form-check-label"],["type","checkbox","id","searchTags",1,"form-check-input",3,"ngModelChange","ngModel"],["for","searchTags",1,"form-check-label"],[1,"search-loading"],[1,"bi","bi-arrow-repeat"]],template:function(t,r){t&1&&(s(0,"div",0)(1,"div",1)(2,"input",2),b("ngModelChange",function(o){return S(r.searchQuery,o)||(r.searchQuery=o),o}),u("input",function(){return r.onSearchInput()})("keyup.enter",function(){return r.onSearch()})("focus",function(){return r.showSuggestions=!0})("blur",function(){return r.onBlur()}),a(),_(3,te,2,0,"button",3),s(4,"button",4),u("click",function(){return r.onSearch()}),g(5,"i",5),a()(),_(6,se,3,2,"div",6)(7,ae,19,3,"div",7)(8,ce,3,0,"div",8),a()),t&2&&(c(2),m("placeholder",r.placeholder),v("ngModel",r.searchQuery),c(),m("ngIf",r.searchQuery),c(3),m("ngIf",r.showSuggestions&&(r.suggestions.length>0||r.searchHistory.length>0)),c(),m("ngIf",r.showAdvancedOptions),c(),m("ngIf",r.isSearching))},dependencies:[L,W,F,X,$,z,K,J,U],styles:[".search-bar[_ngcontent-%COMP%]{position:relative;width:100%;max-width:600px;margin:0 auto}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center;background:#fff;border-radius:4px;box-shadow:0 2px 4px #0000001a}.form-control[_ngcontent-%COMP%]{flex:1;border:none;padding:10px 15px;font-size:16px;outline:none}.btn[_ngcontent-%COMP%]{padding:10px 15px;border:none;background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c82333}.search-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border-radius:4px;box-shadow:0 4px 6px #0000001a;margin-top:5px;z-index:1000;max-height:400px;overflow-y:auto}.search-section[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid #eee}.search-section[_ngcontent-%COMP%]:last-child{border-bottom:none}.search-section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:5px 0;color:#666;font-size:14px}.search-items[_ngcontent-%COMP%]{display:flex;flex-direction:column}.search-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 10px;cursor:pointer;transition:background-color .2s}.search-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.search-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px;color:#666}.advanced-search[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border-radius:4px;box-shadow:0 4px 6px #0000001a;margin-top:5px;padding:15px;z-index:1000}.advanced-search-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.advanced-search-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.form-check[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.search-loading[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;align-items:center;gap:10px;color:#666;font-size:14px}.search-loading[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{G as a};
