import{a as N}from"./chunk-JXDIKL56.js";import{a as P}from"./chunk-ELJGKPYX.js";import{a as j}from"./chunk-M75XJNAF.js";import"./chunk-B2SMLHQB.js";import{d as w,f as A,g as R,j as T}from"./chunk-KNHRAYHO.js";import{Aa as m,Fa as b,Ja as v,K as S,Kb as k,Mb as L,Ob as U,Qa as a,Ta as n,Ua as i,Va as p,Ya as h,Z as f,Za as x,_ as g,_a as u,db as r,eb as C,fb as l,j as E,lb as I,nb as y,ob as D,v as _,wa as s}from"./chunk-4NTA57OQ.js";import"./chunk-2NFLSA4Y.js";var M=o=>["/courses",o,"edit"];function F(o,t){o&1&&(n(0,"div",4)(1,"div",5)(2,"span",6),r(3,"Loading..."),i()(),n(4,"p",7),r(5,"Loading course details..."),i()())}function O(o,t){if(o&1){let e=h();n(0,"div",8),r(1),n(2,"button",9),x("click",function(){f(e);let d=u();return g(d.loadCourse((d.course==null?null:d.course.id)||0))}),r(3,"Try Again"),i()()}if(o&2){let e=u();s(),l(" ",e.error," ")}}function B(o,t){if(o&1&&(n(0,"button",25),r(1," Edit Course "),i()),o&2){let e=u(2);a("routerLink",I(1,M,e.course.id))}}function Y(o,t){if(o&1){let e=h();n(0,"button",26),x("click",function(){f(e);let d=u(2);return g(d.enrollInCourse())}),r(1," Enroll Now "),i()}}function q(o,t){o&1&&(n(0,"span",27),r(1,"Enrolled"),i())}function z(o,t){if(o&1&&(n(0,"p",23)(1,"strong"),r(2,"Price:"),i(),p(3,"br"),r(4),i()),o&2){let e=u(2);s(4),l(" \u20B1",e.course.price," ")}}function G(o,t){if(o&1&&(n(0,"div",10)(1,"div",11)(2,"h2"),r(3),i(),n(4,"div",12),v(5,B,2,3,"button",13)(6,Y,2,0,"button",14)(7,q,2,0,"span",15),i()(),n(8,"div",16)(9,"div",17)(10,"div",18)(11,"h4"),r(12,"Description"),i(),n(13,"p"),r(14),i(),n(15,"h4",19),r(16,"Course Details"),i(),n(17,"ul",20)(18,"li")(19,"strong"),r(20,"Duration:"),i(),r(21),i(),n(22,"li")(23,"strong"),r(24,"Level:"),i(),r(25),i(),n(26,"li")(27,"strong"),r(28,"Category:"),i(),r(29),i()()(),n(30,"div",21)(31,"div",10)(32,"div",16)(33,"h5",22),r(34,"Course Information"),i(),n(35,"p",23)(36,"strong"),r(37,"Created:"),i(),p(38,"br"),r(39),y(40,"date"),i(),n(41,"p",23)(42,"strong"),r(43,"Teacher ID:"),i(),p(44,"br"),r(45),i(),n(46,"p",23)(47,"strong"),r(48,"Enrolled Students:"),i(),p(49,"br"),r(50),i(),n(51,"p",23)(52,"strong"),r(53,"Rating:"),i(),p(54,"br"),r(55),i(),v(56,z,5,1,"p",24),i()()()()()()),o&2){let e=u();s(3),C(e.course.title),s(2),a("ngIf",e.isAdmin),s(),a("ngIf",!e.isEnrolled),s(),a("ngIf",e.isEnrolled),s(7),C(e.course.description),s(7),l(" ",e.course.duration,""),s(4),l(" ",e.course.level,""),s(4),l(" ",e.course.category,""),s(10),l(" ",D(40,13,e.course.createdAt)," "),s(6),l(" ",e.course.teacherId," "),s(5),l(" ",e.course.enrolledStudents?e.course.enrolledStudents.length:0," "),s(5),l(" ",e.course.rating," / 5 "),s(),a("ngIf",e.course.price>0)}}var V=class o{constructor(t,e,c,d,H){this.route=t;this.router=e;this.courseService=c;this.authService=d;this.enrollmentService=H}course=null;currentUser=null;isEnrolled=!1;isAdmin=!1;isLoading=!0;error=null;canEnroll=!1;ngOnInit(){if(this.currentUser=this.authService.getCurrentUser(),!this.currentUser){this.error="Please log in to view course details",this.isLoading=!1;return}let t=this.route.snapshot.paramMap.get("id");console.log("Course ID from route:",t),t?(this.loadCourse(+t),this.checkUserRole()):this.router.navigate(["/courses"])}loadCourse(t){this.isLoading=!0,this.error=null,console.log("Loading course with ID:",t),this.courseService.getCourse(t).pipe(S(e=>console.log("Raw course data:",e)),_(e=>(console.error("Error details:",e),this.error="Course not found. Please check the URL and try again.",this.isLoading=!1,E(null)))).subscribe({next:e=>{e&&(console.log("Course loaded successfully:",e),this.course=e,this.checkEnrollmentStatus()),this.isLoading=!1}})}checkUserRole(){let t=this.authService.getCurrentUser();t&&(this.currentUser=t,this.isAdmin=t.role==="admin",console.log("Current user:",t),this.checkEnrollmentStatus())}checkEnrollmentStatus(){if(!this.currentUser){console.error("No user logged in");return}if(!this.course){console.error("No course loaded");return}console.log("Checking enrollment status for user:",this.currentUser.id,"in course:",this.course.id),this.enrollmentService.getStudentEnrollments(this.currentUser.id).subscribe({next:t=>{console.log("Current enrollments:",t),this.isEnrolled=t.some(e=>e.courseId===this.course?.id&&e.status==="active"),this.canEnroll=!0,console.log("Enrollment status:",this.isEnrolled)},error:t=>{console.error("Error checking enrollment:",t),this.error="Failed to check enrollment status"}})}enrollInCourse(){if(!this.currentUser){this.error="Please log in to enroll in this course";return}if(!this.course){this.error="Course not found";return}console.log("Attempting to enroll user:",this.currentUser.id,"in course:",this.course.id),this.isLoading=!0,this.error=null,this.enrollmentService.enrollStudent(this.currentUser.id,this.course.id).subscribe({next:t=>{console.log("Enrollment successful:",t),this.isEnrolled=!0,this.router.navigate(["/dashboard"])},error:t=>{console.error("Error enrolling in course:",t),t.message==="Already enrolled in this course"?this.error="You are already enrolled in this course":this.error="Failed to enroll in course. Please try again.",this.isLoading=!1}})}static \u0275fac=function(e){return new(e||o)(m(w),m(A),m(j),m(P),m(N))};static \u0275cmp=b({type:o,selectors:[["app-course-detail"]],decls:4,vars:3,consts:[[1,"container","mt-4"],["class","text-center",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["role","alert",1,"alert","alert-danger"],[1,"btn","btn-link",3,"click"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"actions"],["class","btn btn-outline-primary me-2",3,"routerLink",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","badge bg-success",4,"ngIf"],[1,"card-body"],[1,"row"],[1,"col-md-8"],[1,"mt-4"],[1,"list-unstyled"],[1,"col-md-4"],[1,"card-title"],[1,"card-text"],["class","card-text",4,"ngIf"],[1,"btn","btn-outline-primary","me-2",3,"routerLink"],[1,"btn","btn-primary",3,"click"],[1,"badge","bg-success"]],template:function(e,c){e&1&&(n(0,"div",0),v(1,F,6,0,"div",1)(2,O,4,1,"div",2)(3,G,57,15,"div",3),i()),e&2&&(s(),a("ngIf",c.isLoading),s(),a("ngIf",c.error),s(),a("ngIf",!c.isLoading&&!c.error&&c.course))},dependencies:[U,k,L,T,R],encapsulation:2})};export{V as CourseDetailComponent};
