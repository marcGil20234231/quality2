import{a as P}from"./chunk-JXDIKL56.js";import{a as O}from"./chunk-JKVIU2IQ.js";import{a as R}from"./chunk-M75XJNAF.js";import{a as v}from"./chunk-B2SMLHQB.js";import{h as L,k as F}from"./chunk-4BZPK5W5.js";import{Aa as m,Fa as y,Ja as u,Jb as D,Kb as U,N as I,Ob as _,Qa as d,Ra as E,Ta as i,Ua as n,Va as g,_a as S,db as a,eb as p,fb as w,j as f,lb as x,ta as b,wa as s}from"./chunk-4NTA57OQ.js";import"./chunk-2NFLSA4Y.js";var C=class r{constructor(){}getRecommendedCourses(t){let o=v.enrollments.filter(c=>c.studentId===t).map(c=>c.courseId),N=v.courses.filter(c=>!o.includes(c.id)).sort((c,T)=>(T.rating||0)-(c.rating||0)).slice(0,3);return f(N)}getPopularCourses(){let t=v.courses.sort((e,o)=>(o.rating||0)-(e.rating||0)).slice(0,3);return f(t)}getNewCourses(){let t=v.courses.sort((e,o)=>{let l=e.createdAt?new Date(e.createdAt).getTime():0;return(o.createdAt?new Date(o.createdAt).getTime():0)-l}).slice(0,3);return f(t)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=I({token:r,factory:r.\u0275fac,providedIn:"root"})};var M=r=>["/courses",r];function B(r,t){r&1&&(i(0,"div",12)(1,"div",13)(2,"span",14),a(3,"Loading..."),n()()())}function z(r,t){if(r&1&&(i(0,"div",15),a(1),n()),r&2){let e=S();s(),w(" ",e.error," ")}}function $(r,t){r&1&&(i(0,"div",16),a(1," You haven't enrolled in any courses yet. "),i(2,"a",17),a(3,"Browse courses"),n(),a(4," to get started! "),n())}function V(r,t){if(r&1&&(i(0,"div",18)(1,"div",19),g(2,"img",20),i(3,"div",7)(4,"h5",21),a(5),n(),i(6,"p",22),a(7),n(),i(8,"div",23),g(9,"div",24),n(),i(10,"a",25),a(11,"Continue Learning"),n()()()()),r&2){let e=t.$implicit,o=S();s(2),d("src",e.imageUrl,b)("alt",e.title),s(3),p(e.title),s(2),p(e.description),s(2),E("width",o.getCourseProgress(e.id),"%"),s(),d("routerLink",x(7,M,e.id))}}function Y(r,t){if(r&1&&(i(0,"div",18)(1,"div",19),g(2,"img",20),i(3,"div",7)(4,"h5",21),a(5),n(),i(6,"p",22),a(7),n(),i(8,"a",26),a(9,"View Course"),n()()()()),r&2){let e=t.$implicit;s(2),d("src",e.imageUrl,b)("alt",e.title),s(3),p(e.title),s(2),p(e.description),s(),d("routerLink",x(5,M,e.id))}}var A=class r{constructor(t,e,o,l){this.courseService=t;this.enrollmentService=e;this.authService=o;this.recommendationService=l}enrolledCourses=[];recommendedCourses=[];popularCourses=[];newCourses=[];isLoading=!0;error="";currentUser;ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.currentUser&&(this.loadDashboardData(),this.loadRecommendedCourses(),this.loadPopularCourses(),this.loadNewCourses())}loadDashboardData(){this.isLoading=!0;let t=this.authService.getCurrentUser();if(!t){this.error="Please log in to view your dashboard",this.isLoading=!1;return}this.enrollmentService.getStudentEnrollments(t.id).subscribe({next:e=>{let o=e.map(l=>l.courseId);this.courseService.getCourses().subscribe({next:l=>{this.enrolledCourses=l.filter(h=>o.includes(h.id)),this.isLoading=!1},error:l=>{console.error("Error loading courses:",l),this.error="Failed to load courses",this.isLoading=!1}})},error:e=>{console.error("Error loading enrollments:",e),this.error="Failed to load enrollments",this.isLoading=!1}})}loadRecommendedCourses(){this.recommendationService.getRecommendedCourses(this.currentUser.id).subscribe(t=>{this.recommendedCourses=t})}loadPopularCourses(){this.recommendationService.getPopularCourses().subscribe(t=>{this.popularCourses=t})}loadNewCourses(){this.recommendationService.getNewCourses().subscribe(t=>{this.newCourses=t})}getCourseProgress(t){return Math.floor(Math.random()*100)}static \u0275fac=function(e){return new(e||r)(m(R),m(P),m(O),m(C))};static \u0275cmp=y({type:r,selectors:[["app-user-dashboard"]],decls:20,vars:5,consts:[[1,"container","my-4"],[1,"mb-4"],["class","text-center my-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-4"],[1,"card-header","bg-danger","text-white"],[1,"mb-0"],[1,"card-body"],["class","alert alert-info",4,"ngIf"],[1,"row","row-cols-1","row-cols-md-2","row-cols-lg-3","g-4"],["class","col",4,"ngFor","ngForOf"],[1,"card"],[1,"text-center","my-5"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],[1,"alert","alert-danger"],[1,"alert","alert-info"],["routerLink","/courses"],[1,"col"],[1,"card","h-100"],[1,"card-img-top",2,"height","200px","object-fit","cover",3,"src","alt"],[1,"card-title"],[1,"card-text"],[1,"progress","mb-3"],[1,"progress-bar","bg-danger"],[1,"btn","btn-danger",3,"routerLink"],[1,"btn","btn-outline-danger",3,"routerLink"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"h1",1),a(2,"My Dashboard"),n(),u(3,B,4,0,"div",2)(4,z,2,1,"div",3),i(5,"div",4)(6,"div",5)(7,"h5",6),a(8,"My Enrolled Courses"),n()(),i(9,"div",7),u(10,$,5,0,"div",8),i(11,"div",9),u(12,V,12,9,"div",10),n()()(),i(13,"div",11)(14,"div",5)(15,"h5",6),a(16,"Recommended Courses"),n()(),i(17,"div",7)(18,"div",9),u(19,Y,10,7,"div",10),n()()()()),e&2&&(s(3),d("ngIf",o.isLoading),s(),d("ngIf",o.error&&!o.isLoading),s(6),d("ngIf",o.enrolledCourses.length===0),s(2),d("ngForOf",o.enrolledCourses),s(7),d("ngForOf",o.recommendedCourses))},dependencies:[_,D,U,F,L],encapsulation:2})};export{A as UserDashboardComponent};
